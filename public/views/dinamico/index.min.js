/*! Godie007 - 2017-05-01 */
function generarImagen(a,b){var c=a.files;if(c.length>0){var d=c[0];if(d.name.match(/\.(jpg|jpeg|png|gif|tiff|bmp|ico)$/))if(d.size/1024<=1024){var e=new FileReader;e.onload=function(a){var c=document.createElement("img"),d=a.target.result;c.src=d,c.style.height="80px",c.style.width="80px",document.getElementById("imagen"+b).innerHTML=c.outerHTML},e.readAsDataURL(d)}else alert("Disculpe, No se permiten Imagenes mayores a 1024 kb!");else alert("El archivo que intenta subir no es una Imgen")}}function limpiarCampos(){$('input[type=datetime-local]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id*="checkbox"]:not([id*="preview"]):not([id*="group"])').each(function(){$(this).val("")})}function formatAMPM(a){var b=a,c=b.getHours(),d=b.getMinutes(),e=b.getSeconds(),f=c>=12?"PM":"AM";return c=c%12==0?12:c%12,c=c||12,d=d<10?"0"+d:d,e=e<10?"0"+e:e,c+":"+d+":"+e+" "+f}function generarCampos(){setTimeout(function(){$("input[id^='file-']:not([id$='preview'])").each(function(){var a=$(this).attr("id").split("-")[1];$(".field-file-"+a).append('<div id="imagen'+a+'"><img src="/images/default.png" style="height:80px;width:80px;"></div>'),$("#file-"+a).change(function(){generarImagen(this,a)})}),0===$("input[type=checkbox]:checked").length?$(".eliminar").attr("disabled","disabled"):$(".eliminar").css({color:"red"})},1e3),$.ajax({url:"/admin/formulario/"+$("#modulo").attr("class")+"/",type:"POST",data:{modulo:$("#modulo").attr("class")},error:function(a){console.log(a)},success:function(a){$("#panel").css("visibility","hidden"),a.length>0&&window.sessionStorage.setItem("formData",JSON.stringify(JSON.stringify(a)));var b=JSON.stringify(JSON.stringify(a)),c=document.querySelector(".build-wrap"),d=document.querySelector(".render-wrap"),e=b,f=!0,g={dataType:"json"};e&&(g.formData=JSON.parse(e));var h=function(){document.body.classList.toggle("form-rendered",f),f=!f},i=$(c).formBuilder(g).data("formBuilder");h(),$(d).formRender({dataType:"json",formData:i.formData}),$("label").each(function(){var a=$(this).text();if(-1!==a.indexOf("_")){var b=0,c=a.length;for(b;b<c;b++)a=a.replace("_"," ");$(this).text(a)}}),mostrarTabla()}})}function generarTitulosDinamicos(){for(var a="[",b=$('input[type=datetime-local]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id*="checkbox"]:not([id*="preview"]):not([id*="group"])'),c=$('div[class*="field-checkbox-group"]:not([class*="preview"])'),d=0;d<c.length;d++){a+="{";a+='"label":"'+c.eq(d).contents().eq(0).text().trim().replace("?","")+'",',a+='"valor":""',a+="},"}for(var e=0;e<b.length;e++){var f;a+="{",f=b.eq(e).parent().find("label").text().trim(),b.eq(e).parent().find("label").length>1&&(f=b.eq(e).parent().parent().find("label").eq(0).text().trim()),0===b.eq(e).parent().find("label").length&&(f=b.eq(e).parent().parent().find("label").text()),a+='"label":"'+f.replace("?","")+'",',a+='"valor":""',a+="},"}a+='{"label":"Usuario de Creación",',a+='"valor":""},',a+='{"label":"Fecha de Creación",',a+='"valor":""},',a+='{"label":"Usuario de Actualización",',a+='"valor":""},',a+='{"label":"Fecha de Actualización",',a+='"valor":""}',a+="]";for(var g=JSON.parse(a),h=[{data:"_id",title:"<input type='checkbox' id='example-select-all'>"},{data:"indice",title:"N°"}],i="[",j=0;j<g.length;j++)i+='{"data": "'+g[j].label+'","title": "'+g[j].label+'"}',j!==g.length-1&&(i+=",");i+="]";for(var k=JSON.parse(i),l=0;l<k.length;l++)h.push(k[l]);return h.push({data:"_id",title:"Acción",searchable:!1,orderable:!1,render:function(a,b,c){return'<div class="btn-group"><button type="button" data-toggle="modal" onclick="ver(&quot;'+a+'&quot;);" data-target="#myModal" class="btn btn-default" >Editar</button><button type="button" onclick="eliminar(&quot;'+a+'&quot;);"class="btn btn-default" >Eliminar</button></div>'}}),h}function tomarValores(){for(var a="[",b=$('div[class*="field-checkbox-group"]:not([class*="preview"])'),c=0;c<b.length;c++){var d=$(b[c]).find("label"),e=$(b[c]).find("input");a+="{";for(var f="",g="",h=1;h<d.length;h++){var i=$(d[h]).text().trim();$(e[h-1]).is(":checked")&&(f+=i+"<br>",g+=$(e[h-1]).attr("id")),""!==i&&h<d.length-1&&(g+="/*")}a+='"titulo":"'+b.eq(c).contents().eq(0).text().trim().replace("?","")+'",',a+='"valor":"'+f+'",',a+='"id":"'+g+'"',a+="},"}for(var j=$('input[type=datetime-local]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id*="checkbox"]:not([id*="preview"]):not([id*="group"])'),k=j.length-1;k>=0;k--){if(j.eq(k).length>0){var l=j.eq(k).parent().find("label").eq(0).text().trim(),m=""===j.eq(k).val()?" ":j.eq(k).val();if(-1!==j.eq(k).attr("id").indexOf("radio-group")){l=j.eq(k).parent().parent().find("label").eq(0).text().trim();var n=j.eq(k).attr("id").split("-")[3];m=j.eq(k).parent().find("label").eq(n).text().trim()}if(-1!==j.eq(k).attr("id").indexOf("select-")&&(m=j.eq(k).find("option:selected").val()),-1!==j.eq(k).attr("id").indexOf("file-")){var o=j.eq(k).attr("id").split("-")[1],p=$("#imagen"+o+" img").prop("src");void 0!==p&&""!==p||(p="/images/default.png"),m="<img src="+p+" style=height:80px;width:80px;>"}-1!==j.eq(k).attr("id").indexOf("checkbox-")&&(l=0===j.eq(k).parent().find("label").length?j.eq(k).parent().parent().find("label").text().trim():j.eq(k).parent().find("label").text().trim(),m=$("#"+j.eq(k).attr("id")).is(":checked")),a+='{"id":"'+j.eq(k).attr("id")+'",',a+='"titulo":"'+l.replace("?","")+'",',a+='"valor":"'+m+'"}'}k>0&&""===$("#id").val()&&(a+=","),""!==$("#id").val()&&(a+=",")}if(""!==$("#id").val()){var q=new Date,r=q.getDate()+"/"+(q.getMonth()+1)+"/"+q.getFullYear()+" "+formatAMPM(q);a+='{"id":"usuAct",',a+='"titulo":"Usuario de Actualización",',a+='"valor":"'+$("#usuario").attr("class")+'"},',a+='{"id":"fechaC",',a+='"titulo":"Fecha de Actualización",',a+='"valor":"'+r+'"}'}return a+="]",JSON.parse(a)}function mostrarTabla(){$.ajax({url:"/admin/"+$("#modulo").attr("class")+"/listar/",type:"GET",error:function(a){console.log(a)},success:function(a){mostrar(a),$(".ingresar").trigger("focus")}})}function mostrar(a){registro=a;for(var b=[],c=$('input[type=datetime-local]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id^="checkbox-"]:not([id*="preview"]),div[class*="radio-group"]:not([class*="preview"])'),d=0;d<a.length;d++){b.push({}),b[d].indice=d,b[d]._id=a[d]._id;for(var e=0;e<c.length;e++){var f=c.eq(c.length-1-e).parent().find("label").eq(0).text().trim();c.eq(c.length-1-e).parent().find("label").length>1&&(f=c.eq(c.length-1-e).parent().parent().find("label").eq(0).text().trim()),0===c.eq(e).parent().find("label").length&&(f=c.eq(c.length-1-e).parent().parent().find("label").eq(0).text().trim()),f=f.replace("?",""),b[d][f]="",b[d]["Fecha de Actualización"]="",b[d]["Fecha de Creación"]="",b[d]["Usuario de Creación"]="",b[d]["Usuario de Actualización"]=""}for(var g=0;g<c.length;g++)if(void 0!==a[d].data[g]){var h=a[d].data[g].valor;"Valor"===a[d].data[g].titulo&&(h="$"+separar(a[d].data[g].valor+"",",")),b[d][a[d].data[g].titulo]=h}var i=new Date(a[d].fecha_creacion),j=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+formatAMPM(i);if(b[d]["Fecha de Creación"]=j,b[d]["Usuario de Creación"]=a[d].usuario,void 0!==a[d].data[c.length])for(var k=0;k<a[d].data.length;k++)"Fecha de Actualización"===a[d].data[k].titulo&&(b[d]["Fecha de Actualización"]=a[d].data[k].valor),"Usuario de Actualización"===a[d].data[k].titulo&&(b[d]["Usuario de Actualización"]=a[d].data[k].valor)}$("input[id^=date-]").addClass("form-control").attr("type","datetime-local"),table=$("#example").DataTable({data:b,order:[[1,"asc"]],columns:generarTitulosDinamicos(),columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:function(a,b,c,d){return'<input type="checkbox" class="'+$("<div/>").text(a).html()+'">'}}],destroy:!0,select:!0,responsive:!0,altEditor:!0,dom:"Bfrtip",stateSave:!0,lengthMenu:[[10,25,50,100,500,-1],["10 Filas","25 Filas","50 Filas","100 Filas","500 Filas","Mostrar Todo"]],buttons:[{text:"Filas",extend:"pageLength"},{text:"Ingresar",className:"ingresar",action:function(a,b,c,d){$("#id").val(""),$("#myModal").modal("show"),$("#actualizar").hide(),$("#guardar").show(),limpiarCampos(),$("div[id^=imagen]").each(function(){$(this).find("img").prop("src","/images/default.png")}),setTimeout(function(){$("input:visible").eq(0).trigger("focus")},200)}},{text:"Mostrar Columnas",postfixButtons:["colvisRestore"],extend:"colvis"},{text:"Eliminar Selección",className:"eliminar",action:function(a,b,c,d){confirm("Esta Seguro?")&&(toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.warning("Los inventarios se han Eliminado!.","Importante!"),$("input[type='checkbox']").each(function(){$(this).is(":checked")&&$.ajax({url:"http://"+window.location.hostname+":"+window.location.port+"/admin/"+$("#modulo").attr("class")+"/",type:"DELETE",data:{id:$(this).attr("class")},error:function(a){console.log("Error "+a)},success:function(a){console.log(a)}})}),setTimeout(function(){mostrarTabla()},500))}},{extend:"collection",text:"Exportar",buttons:[{extend:"pdfHtml5",exportOptions:{columns:":not(:last-child)"}},{extend:"csvHtml5",exportOptions:{columns:":not(:last-child)"}},{extend:"copyHtml5",exportOptions:{columns:":not(:last-child)"}},{extend:"excelHtml5",exportOptions:{columns:":not(:last-child)"},customize:function(a){var b=a.xl.worksheets["sheet1.xml"];$('row c[r^="C"]',b).attr("s","2")}}]}]}),$("input[type=checkbox]:visible").click(function(){$(".eliminar").removeAttr("disabled"),0===$("input[type=checkbox]:checked").length?$(".eliminar").attr("disabled","disabled"):$(".eliminar").css({color:"red"})}),$("#example-select-all").on("click",function(){var a=table.rows({search:"applied"}).nodes();$('input[type="checkbox"]',a).prop("checked",this.checked),$('input[type="checkbox"]',a).is(":checked")?$(".eliminar").css({color:"red"}):($(".eliminar").css({color:"black"}),$(".eliminar").attr("disabled","disabled"))})}function separar(a,b){return void 0!==a&&""!==a?a.replace(/\B(?=(\d{3})+(?!\d))/g,b):""}window.ver=function(a){$("#id").val(a),$.ajax({url:"/admin/"+$("#modulo").attr("class")+"/ver/",type:"POST",data:{id:a},error:function(a){console.log(a)},success:function(a){console.log("Se limpian Campos"),limpiarCampos();for(var b=0;b<a.length;b++){var c=a[b].valor,d=a[b].id,e=a[b].id.split("-")[0],f=a[b].id.split("-")[0]+"-"+a[b].id.split("-")[1];if("textarea"===e&&$("#"+d).val(c),"file"===e){var g=a[b].id.split("-")[1];$("#imagen"+g).html(c)}if("text"===e&&$("#"+d).val(c),"radio"===e&&$("#"+d).prop("checked",!0),"select"===e&&$("#"+d).val(c),"date"===e&&$("#"+d).val(c),"number"===e&&$("#"+d).val(c),"checkbox"===e){var h=$("#"+d).prop("checked");c="true"===c,c!==h&&$("#"+d).prop("checked",c)}if("checkbox-group"===f)for(var i=a[b].id.split("/*"),j=0;j<i.length;j++)$("#"+i[j]).prop("checked",!0)}setTimeout(function(){$("input:visible").eq(0).trigger("focus")},200),$("#actualizar").show(),$("#guardar").hide()}})},window.eliminar=function(a){confirm("Esta Seguro?")&&(toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.warning("El registro se ha Eliminado!.","Importante!"),$.ajax({url:"/admin/"+$("#modulo").attr("class")+"/",type:"DELETE",data:{id:a},error:function(a){console.log(a)},success:function(a){""!==a&&(mostrarTabla(),console.log(a))}}))},$(document).ready(function(){generarCampos(),$("#menuContactos").click(),$("#menuCientes").click(),$("#in_3").css({outline:"none","background-color":"#393a39",color:"white"}),$("#actualizar").hide(),$(".alert").hide(),$("#guardar").show(),$("#ingresar").click(function(){$("#guardar").show(),$("#actualizar").hide(),$("input,textarea").val(""),$(".alert").hide()}),$("#guardar").click(function(){toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.success("Se ha Guardado el Producto.","Felicidades!"),$.ajax({url:"/admin/"+$("#modulo").attr("class")+"/",type:"POST",data:{data:tomarValores(),usuario:$("#usuario").attr("class"),modulo:$("#modulo").attr("class"),empresa:$("#empresa").attr("class")},error:function(a){console.log(a)},success:function(a){""!==a&&(mostrarTabla(),$("#myModal").modal("hide"),$("#myModal").hide(),$(".modal-backdrop").hide())}})}),$("#actualizar").click(function(){$(".alert").hide(),toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.info("Actualizado Correctamente.","Felicidades!"),$.ajax({url:"/admin/"+$("#modulo").attr("class")+"/",type:"PUT",data:{_id:$("#id").val(),data:tomarValores()},error:function(a){console.log(a)},success:function(a){""!==a&&($(".alert").show(),mostrarTabla())}})})}),window.registro=[];
//# sourceMappingURL=index.min.js.map