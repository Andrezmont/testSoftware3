{"version":3,"sources":["personalizar.js"],"names":["$","document","ready","formBuilder","ajax","url","attr","type","success","respuesta","almacenarCampos","datos","JSON","parse","formData","i","length","entrada","indice","usuario","modulo","empresa","data","window","sessionStorage","setItem","stringify","almacenados","buildWrap","querySelector","renderWrap","editBtn","getElementById","editing","fbOptions","dataType","toggleEdit","body","classList","toggle","formRender","addClass","each","id","this","split","append","nombre","text","parent","find","remove","click","inputs","formulario","getItem","valorActual","val","parseInt","valorAnterior","undefined","label","setTimeout","toastr","options","closeButton","debug","newestOnTop","progressBar","positionClass","preventDuplicates","timeOut","onclick","hilo","hide","clearInterval","setInterval"],"mappings":"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","file":"personalizar.min.js","sourcesContent":["$(document).ready(function() {\n  var formBuilder;\n    $.ajax({\n        url: \"/admin/formulario/\" + $(\"#modulo\").attr(\"class\") + \"/\",\n        type: 'POST',\n        success: function(respuesta) {\n            if (respuesta.length > 0) {\n                window.sessionStorage.setItem('formData', JSON.stringify(JSON.stringify(respuesta)));\n            }\n            var almacenados = JSON.stringify(JSON.stringify(respuesta));\n            var buildWrap = document.querySelector('.build-wrap'),\n                renderWrap = document.querySelector('.render-wrap'),\n                editBtn = document.getElementById('edit-form'),\n                formData = almacenados,\n                editing = true,\n                fbOptions = {\n                    dataType: 'json'\n                };\n            if (formData) {\n                fbOptions.formData = JSON.parse(formData);\n            }\n            var toggleEdit = function() {\n                document.body.classList.toggle('form-rendered', editing);\n                editing = !editing;\n            };\n            function almacenarCampos() {\n                /**\n                 * @autor:godie007\n                 * @date: 2016/12/24 01:35\n                 * Se eliminan los anteriores campos\n                 **/\n                $.ajax({\n                    url: \"/admin/\" + $(\"#modulo\").attr(\"class\") + \"Todo/\",\n                    type: 'DELETE',\n                    success: function(respuesta) {\n                        /**\n                         * @autor:godie007\n                         * @date: 2016/12/24 01:10\n                         * Se ingresan registros de nuevos campos en base de datos\n                         **/\n                        var datos = JSON.parse(formBuilder.formData);\n                        for (var i = 0; i < datos.length; i++) {\n                            var entrada = datos[i];\n                            entrada.indice = i;\n                            entrada.usuario = $(\"#usuario\").attr(\"class\");\n                            entrada.modulo = $(\"#modulo\").attr(\"class\");\n                            entrada.empresa = $(\"#empresa\").attr(\"class\");\n                            $.ajax({\n                                url: \"/admin/\" + $(\"#modulo\").attr(\"class\") + \"/dinamica/\",\n                                type: 'POST',\n                                data: entrada\n                            });\n                        }\n                    }\n                });\n            }\n            formBuilder = $(buildWrap).formBuilder(fbOptions).data('formBuilder');\n            toggleEdit();\n            $(renderWrap).formRender({\n                dataType: 'json',\n                formData: formBuilder.formData\n            });\n            $(\"input[id^=date-]\").addClass(\"form-control\").attr('type', 'datetime-local');\n            $(\"input[id^='file-']:visible\").each(function() {\n                var id = $(this).attr(\"id\").split(\"-\")[1];\n                $(\".field-file-\" + id).append('<div id=\"imagen' + id + '\"></div>');\n                //$(\"#file-\" + id).change(function() {\n                //    encodeImageFileAsURL(this, id);\n                //});\n            });\n            $(\".field-label\").each(function() {\n                var nombre = $(this).text();\n                if (nombre === 'Nombre' ||\n                    nombre === 'Valor' ||\n                    nombre === 'Cedula' ||\n                    nombre === 'Cantidad') {\n                    $(this).parent().find(\".field-actions\").remove();\n                }\n            });\n            $('.form-builder-save').click(function() {\n                /**\n                 * @autor:godie007\n                 * @date: 2016/12/24 01:17\n                 * Se actualiza el nuevo nombre de los campos modificados en el formulario\n                 * de drag and drop\n                 **/\n                var inputs = $('input[name=\"label\"]');\n                var formulario = JSON.parse(JSON.parse(window.sessionStorage.getItem('formData')));\n                if (formulario !== null) {\n                    /**\n                     * @autor:godie007\n                     * @date: 2017/12/30 17:53\n                     * Se busca si cambio alguno de los campos dinamicos para actualizar en base de datos\n                     * los registro que tenian el anterior nombre\n                     **/\n                    for (var i = 0; i < inputs.length; i++) {\n                        var valorActual = $(inputs[i]).val();\n                        var indice = parseInt($(inputs[i]).attr(\"id\").split(\"fld-\")[1]) - 1;\n                        var valorAnterior = $(inputs[i]).val();\n                        if (formulario[indice] !== undefined) {\n                            valorAnterior = formulario[indice].label;\n                        }\n                        if (valorAnterior !== valorActual) {\n                            $.ajax({\n                                url: \"/admin/\" + $(\"#modulo\").attr(\"class\") + \"/nombrar\",\n                                type: 'PUT',\n                                data: {\n                                    'valorActual': valorActual,\n                                    'valorAnterior': valorAnterior,\n                                    'usuario': $(\"#usuario\").attr(\"class\")\n                                }\n                            });\n                        }\n                    }\n                }\n                /**\n                 * @autor:godie007\n                 * @date: 2016/12/24 01:45\n                 * Se actualiza el Formulario Dinamico\n                 **/\n                toggleEdit();\n                $(renderWrap).formRender({\n                    dataType: 'json',\n                    formData: formBuilder.formData\n                });\n                window.sessionStorage.setItem('formData', JSON.stringify(formBuilder.formData));\n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        debug: false,\n                        newestOnTop: false,\n                        progressBar: true,\n                        positionClass: \"toast-top-center\" || 'toast-top-right',\n                        preventDuplicates: false,\n                        timeOut: \"1000\",\n                        onclick: null\n                    };\n                    //success error warning info\n                    toastr.success(\"Se Modifico Exitosamente!\", \"Felicidades!\");\n                }, 100);\n                almacenarCampos();\n            });\n            editBtn.onclick = function() {\n                toggleEdit();\n            };\n        }\n    });\n    /**\n     * @autor:godie007\n     * @date: 2017/01/02 11:50\n     * Se usa un hilo para ocultar los campos innesesarios del Builder Plugin\n     * con el objetivo de hacer mas simple la interfaz a lo usuarios Finales\n     **/\n    var hilo = function() {\n        if ($(\".fld-className.form-control:visible\").length === 1) {\n            $(\".form-group.className-wrap\").hide();\n            $(\".form-group.name-wrap\").hide();\n            $(\".form-group.other-wrap\").hide();\n            clearInterval(hilo);\n        }\n    };\n    $(\".close-field\").click(function() {\n        setInterval(hilo, 200);\n    });\n    setInterval(hilo, 200);\n});\n"]}