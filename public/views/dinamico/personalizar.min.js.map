{"version":3,"sources":["personalizar.js"],"names":["$","document","ready","ajax","url","attr","type","success","respuesta","almacenarCampos","error","datos","JSON","parse","formBuilder","formData","i","length","entrada","indice","usuario","modulo","empresa","data","window","sessionStorage","setItem","stringify","almacenados","buildWrap","querySelector","renderWrap","editBtn","getElementById","editing","fbOptions","dataType","toggleEdit","body","classList","toggle","formRender","addClass","each","id","this","split","append","change","encodeImageFileAsURL","nombre","text","parent","find","remove","click","inputs","formulario","getItem","valorActual","val","parseInt","valorAnterior","undefined","label","setTimeout","toastr","options","closeButton","debug","newestOnTop","progressBar","positionClass","preventDuplicates","timeOut","onclick","hilo","hide","clearInterval","setInterval"],"mappings":"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","file":"personalizar.min.js","sourcesContent":["$(document).ready(function() {\n    $.ajax({\n        url: \"/admin/formulario/\" + $(\"#modulo\").attr(\"class\") + \"/\",\n        type: 'POST',\n        success: function(respuesta) {\n            if (respuesta.length > 0) {\n                window.sessionStorage.setItem('formData', JSON.stringify(JSON.stringify(respuesta)));\n            }\n            var almacenados = JSON.stringify(JSON.stringify(respuesta));\n            var buildWrap = document.querySelector('.build-wrap'),\n                renderWrap = document.querySelector('.render-wrap'),\n                editBtn = document.getElementById('edit-form'),\n                formData = almacenados,\n                editing = true,\n                fbOptions = {\n                    dataType: 'json'\n                };\n            if (formData) {\n                fbOptions.formData = JSON.parse(formData);\n            }\n            var toggleEdit = function() {\n                document.body.classList.toggle('form-rendered', editing);\n                editing = !editing;\n            };\n            function almacenarCampos() {\n                /**\n                 * @autor:godie007\n                 * @date: 2016/12/24 01:35\n                 * Se eliminan los anteriores campos\n                 **/\n                $.ajax({\n                    url: \"/admin/\" + $(\"#modulo\").attr(\"class\") + \"Todo/\",\n                    type: 'DELETE',\n                    error: function(respuesta) {},\n                    success: function(respuesta) {\n                        /**\n                         * @autor:godie007\n                         * @date: 2016/12/24 01:10\n                         * Se ingresan registros de nuevos campos en base de datos\n                         **/\n                        var datos = JSON.parse(formBuilder.formData);\n                        for (var i = 0; i < datos.length; i++) {\n                            var entrada = datos[i];\n                            entrada.indice = i;\n                            entrada.usuario = $(\"#usuario\").attr(\"class\");\n                            entrada.modulo = $(\"#modulo\").attr(\"class\");\n                            entrada.empresa = $(\"#empresa\").attr(\"class\");\n                            $.ajax({\n                                url: \"/admin/\" + $(\"#modulo\").attr(\"class\") + \"/dinamica/\",\n                                type: 'POST',\n                                data: entrada\n                            });\n                        }\n                    }\n                });\n            }\n            var formBuilder = $(buildWrap).formBuilder(fbOptions).data('formBuilder');\n            toggleEdit();\n            $(renderWrap).formRender({\n                dataType: 'json',\n                formData: formBuilder.formData\n            });\n            $(\"input[id^=date-]\").addClass(\"form-control\").attr('type', 'datetime-local');\n            $(\"input[id^='file-']:visible\").each(function() {\n                var id = $(this).attr(\"id\").split(\"-\")[1];\n                $(\".field-file-\" + id).append('<div id=\"imagen' + id + '\"></div>');\n                $(\"#file-\" + id).change(function() {\n                    encodeImageFileAsURL(this, id);\n                });\n            });\n            $(\".field-label\").each(function() {\n                var nombre = $(this).text();\n                if (nombre === 'Nombre' ||\n                    nombre === 'Valor' ||\n                    nombre === 'Cedula' ||\n                    nombre === 'Cantidad') {\n                    $(this).parent().find(\".field-actions\").remove();\n                }\n            });\n            $('.form-builder-save').click(function() {\n                /**\n                 * @autor:godie007\n                 * @date: 2016/12/24 01:17\n                 * Se actualiza el nuevo nombre de los campos modificados en el formulario\n                 * de drag and drop\n                 **/\n                var inputs = $('input[name=\"label\"]');\n                var formulario = JSON.parse(JSON.parse(window.sessionStorage.getItem('formData')));\n                if (formulario !== null) {\n                    /**\n                     * @autor:godie007\n                     * @date: 2017/12/30 17:53\n                     * Se busca si cambio alguno de los campos dinamicos para actualizar en base de datos\n                     * los registro que tenian el anterior nombre\n                     **/\n                    for (var i = 0; i < inputs.length; i++) {\n                        var valorActual = $(inputs[i]).val();\n                        var indice = parseInt($(inputs[i]).attr(\"id\").split(\"fld-\")[1]) - 1;\n                        var valorAnterior = $(inputs[i]).val();\n                        if (formulario[indice] !== undefined) {\n                            valorAnterior = formulario[indice].label;\n                        }\n                        if (valorAnterior !== valorActual) {\n                            $.ajax({\n                                url: \"/admin/\" + $(\"#modulo\").attr(\"class\") + \"/nombrar\",\n                                type: 'PUT',\n                                data: {\n                                    'valorActual': valorActual,\n                                    'valorAnterior': valorAnterior,\n                                    'usuario': $(\"#usuario\").attr(\"class\")\n                                }\n                            });\n                        }\n                    }\n                }\n                /**\n                 * @autor:godie007\n                 * @date: 2016/12/24 01:45\n                 * Se actualiza el Formulario Dinamico\n                 **/\n                toggleEdit();\n                $(renderWrap).formRender({\n                    dataType: 'json',\n                    formData: formBuilder.formData\n                });\n                window.sessionStorage.setItem('formData', JSON.stringify(formBuilder.formData));\n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        debug: false,\n                        newestOnTop: false,\n                        progressBar: true,\n                        positionClass: \"toast-top-center\" || 'toast-top-right',\n                        preventDuplicates: false,\n                        timeOut: \"1000\",\n                        onclick: null\n                    };\n                    //success error warning info\n                    toastr.success(\"Se Modifico Exitosamente!\", \"Felicidades!\");\n                }, 100);\n                almacenarCampos();\n            });\n            editBtn.onclick = function() {\n                toggleEdit();\n            };\n        }\n    });\n    /**\n     * @autor:godie007\n     * @date: 2017/01/02 11:50\n     * Se usa un hilo para ocultar los campos innesesarios del Builder Plugin\n     * con el objetivo de hacer mas simple la interfaz a lo usuarios Finales\n     **/\n    var hilo = function() {\n        if ($(\".fld-className.form-control:visible\").length === 1) {\n            $(\".form-group.className-wrap\").hide();\n            $(\".form-group.name-wrap\").hide();\n            $(\".form-group.other-wrap\").hide();\n            clearInterval(hilo);\n        }\n    };\n    $(\".close-field\").click(function() {\n        setInterval(hilo, 200);\n    });\n    setInterval(hilo, 200);\n});\n"]}