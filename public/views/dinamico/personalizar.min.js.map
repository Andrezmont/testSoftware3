{"version":3,"sources":["personalizar.js"],"names":["$","document","ready","ajax","url","attr","type","error","respuesta","console","log","success","almacenarCampos","datos","JSON","parse","formBuilder","formData","i","length","entrada","indice","usuario","modulo","empresa","data","window","sessionStorage","setItem","stringify","almacenados","buildWrap","querySelector","renderWrap","editBtn","getElementById","editing","fbOptions","dataType","toggleEdit","body","classList","toggle","formRender","addClass","each","id","this","split","append","change","encodeImageFileAsURL","nombre","text","parent","find","remove","click","inputs","formulario","getItem","valorActual","val","parseInt","valorAnterior","undefined","label","setTimeout","toastr","options","closeButton","debug","newestOnTop","progressBar","positionClass","preventDuplicates","timeOut","onclick","hilo","hide","clearInterval","setInterval"],"mappings":"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","file":"personalizar.min.js","sourcesContent":["$(document).ready(function() {\n    $.ajax({\n        url: \"/admin/formulario/\"+$(\"#modulo\").attr(\"class\")+\"/\",\n        type: 'POST',\n        error: function(respuesta) {\n            \n        },\n        success: function(respuesta) {\n            \n            if (respuesta.length > 0) {\n                window.sessionStorage.setItem('formData', JSON.stringify(JSON.stringify(respuesta)));\n            }\n            var almacenados = JSON.stringify(JSON.stringify(respuesta));\n            var buildWrap = document.querySelector('.build-wrap'),\n                renderWrap = document.querySelector('.render-wrap'),\n                editBtn = document.getElementById('edit-form'),\n                formData = almacenados,\n                editing = true,\n                fbOptions = {\n                    dataType: 'json'\n                };\n            if (formData) {\n                fbOptions.formData = JSON.parse(formData);\n            }\n            var toggleEdit = function() {\n                document.body.classList.toggle('form-rendered', editing);\n                editing = !editing;\n            };\n            function almacenarCampos() {\n\n              /**\n              * @autor:godie007\n              * @date: 2016/12/24 01:35\n              * Se eliminan los anteriores campos\n              **/\n              $.ajax({\n                  url: \"/admin/\"+$(\"#modulo\").attr(\"class\")+\"Todo/\",\n                  type: 'DELETE',\n                  error: function(respuesta) {\n                      \n                  },\n                  success: function(respuesta) {\n\n                      /**\n                      * @autor:godie007\n                      * @date: 2016/12/24 01:10\n                      * Se ingresan registros de nuevos campos en base de datos\n                      **/\n                      var datos = JSON.parse(formBuilder.formData);\n                      for (var i = 0; i < datos.length; i++) {\n                          var entrada = datos[i];\n                          entrada.indice = i;\n                          entrada.usuario = $(\"#usuario\").attr(\"class\");\n                          entrada.modulo = $(\"#modulo\").attr(\"class\");\n                          entrada.empresa = $(\"#empresa\").attr(\"class\");\n\n                          $.ajax({\n                              url: \"/admin/\"+$(\"#modulo\").attr(\"class\")+\"/dinamica/\",\n                              type: 'POST',\n                              data: entrada\n                          });\n\n                      }\n                  }\n              });\n\n\n            }\n            var formBuilder = $(buildWrap).formBuilder(fbOptions).data('formBuilder');\n            toggleEdit();\n            $(renderWrap).formRender({\n                dataType: 'json',\n                formData: formBuilder.formData\n            });\n            $(\"input[id^=date-]\").addClass(\"form-control\").attr('type','datetime-local');\n            $(\"input[id^='file-']:visible\").each(function() {\n                var id = $(this).attr(\"id\").split(\"-\")[1];\n                $(\".field-file-\" + id).append('<div id=\"imagen' + id + '\"></div>');\n                $(\"#file-\" + id).change(function() {\n                    encodeImageFileAsURL(this, id);\n                });\n            });\n            $(\".field-label\").each(function() {\n              var nombre = $(this).text();\n              if (nombre === 'Nombre'||\n                  nombre === 'Valor'||\n                  nombre === 'Cedula'||\n                  nombre === 'Cantidad') {\n                $(this).parent().find(\".field-actions\").remove();\n              }\n            });\n\n            $('.form-builder-save').click(function() {\n              /**\n               * @autor:godie007\n               * @date: 2016/12/24 01:17\n               * Se actualiza el nuevo nombre de los campos modificados en el formulario\n               * de drag and drop\n               **/\n              var inputs = $('input[name=\"label\"]');\n              var formulario = JSON.parse(JSON.parse(window.sessionStorage.getItem('formData')));\n              if (formulario !== null) {\n                /**\n                * @autor:godie007\n                * @date: 2017/12/30 17:53\n                * Se busca si cambio alguno de los campos dinamicos para actualizar en base de datos\n                * los registro que tenian el anterior nombre\n                **/\n                for (var i = 0; i < inputs.length; i++) {\n                  var valorActual = $(inputs[i]).val();\n                  var indice = parseInt($(inputs[i]).attr(\"id\").split(\"fld-\")[1]) - 1;\n                  var valorAnterior = $(inputs[i]).val();\n                  if (formulario[indice] !== undefined) {\n                    valorAnterior = formulario[indice].label;\n                  }\n                  if (valorAnterior !== valorActual) {\n                      $.ajax({\n                          url: \"/admin/\"+$(\"#modulo\").attr(\"class\")+\"/nombrar\",\n                          type: 'PUT',\n                          data: {\n                              'valorActual': valorActual,\n                              'valorAnterior': valorAnterior,\n                              'usuario': $(\"#usuario\").attr(\"class\")\n                          }\n                      });\n                  }\n              }\n            }\n              /**\n               * @autor:godie007\n               * @date: 2016/12/24 01:45\n               * Se actualiza el Formulario Dinamico\n               **/\n              toggleEdit();\n              $(renderWrap).formRender({\n                  dataType: 'json',\n                  formData: formBuilder.formData\n              });\n              window.sessionStorage.setItem('formData', JSON.stringify(formBuilder.formData));\n              setTimeout(function () {\n                toastr.options = {\n                    closeButton: true,\n                    debug: false,\n                    newestOnTop: false,\n                    progressBar: true,\n                    positionClass: \"toast-top-center\" || 'toast-top-right',\n                    preventDuplicates: false,\n                    timeOut: \"1000\",\n                    onclick: null\n                };\n                //success error warning info\n                toastr.success(\"Se Modifico Exitosamente!\", \"Felicidades!\");\n              },100);\n              almacenarCampos();\n\n            });\n            editBtn.onclick = function() {\n                toggleEdit();\n            };\n        }\n    });\n    /**\n    * @autor:godie007\n    * @date: 2017/01/02 11:50\n    * Se usa un hilo para ocultar los campos innesesarios del Builder Plugin\n    * con el objetivo de hacer mas simple la interfaz a lo usuarios Finales\n    **/\n    var hilo = function() {\n        if ($(\".fld-className.form-control:visible\").length === 1) {\n            $(\".form-group.className-wrap\").hide();\n            $(\".form-group.name-wrap\").hide();\n            $(\".form-group.other-wrap\").hide();\n            clearInterval(hilo);\n        }\n    };\n    $(\".close-field\").click(function() {\n        setInterval(hilo, 200);\n    });\n    setInterval(hilo, 200);\n});\n"]}