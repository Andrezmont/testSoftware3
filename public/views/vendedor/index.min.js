/*
 Godie007 2017-01-20 
*/

function encodeImageFileAsURL(a,b){var c=a.files;if(c.length>0){var d=c[0];if(d.name.match(/\.(jpg|jpeg|png|gif|tiff|bmp|ico)$/))if(d.size/1024<=1024){var e=new FileReader;e.onload=function(a){var c=document.createElement("img"),d=a.target.result;c.src=d,c.style.height="80px",c.style.width="80px",document.getElementById("imagen"+b).innerHTML=c.outerHTML},e.readAsDataURL(d)}else alert("Disculpe, No se permiten Imagenes mayores a 30 kb!");else alert("El archivo que intenta subir no es una Imgen")}}function limpiarCampos(){var a=$('input[type=date]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id*="checkbox"]:not([id*="preview"]):not([id*="group"])');a.each(function(){$(this).val("")})}function ver(a){$("#id").val(a),$("#myModal").show(),$(".modal-backdrop").show(),$.ajax({url:"/account/vendedor/ver/",type:"POST",data:{id:a},error:function(a){console.log(a)},success:function(a){limpiarCampos();for(var b=0;b<a.campos.length;b++){var c=a.campos[b].valor,d=a.campos[b].id,e=a.campos[b].id.split("-")[0],f=a.campos[b].id.split("-")[0]+"-"+a.campos[b].id.split("-")[1];if("textarea"===e&&$("#"+d).val(c),"file"===e){var g=a.campos[b].id.split("-")[1];$("#imagen"+g).html(c)}if("text"===e&&$("#"+d).val(c),"radio"===e&&$("#"+d).prop("checked",!0),"select"===e&&$("#"+d).val(c),"date"===e&&$("#"+d).val(c),"number"===e&&$("#"+d).val(c),"checkbox"===e){var h=$("#"+d).prop("checked");c="true"===c,c!==h&&($("#"+d).prop("checked",c),$("#"+d).trigger("click"))}if("checkbox-group"===f)for(var i=a.campos[b].id.split("/*"),j=0;j<i.length;j++)$("#"+i[j]).prop("checked",!0)}$("#actualizar").show(),$("#guardar").hide()}})}function eliminar(a){confirm("Esta Seguro?")&&(toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.warning("El vendedor se ha Eliminado!.","Importante!"),$.ajax({url:"/account/vendedor/",type:"DELETE",data:{id:a},error:function(a){console.log(a)},success:function(a){""!=a&&mostrarTabla()}}))}function generarCampos(){setTimeout(function(){$("input[id^='file-']:not([id$='preview'])").each(function(){var a=$(this).attr("id").split("-")[1];$(".field-file-"+a).append('<div id="imagen'+a+'"></div>'),$("#file-"+a).change(function(){encodeImageFileAsURL(this,a)})})},100),$.ajax({url:"/account/formulario/vendedor/",type:"POST",data:{modulo:$("#modulo").attr("class")},error:function(a){console.log(a)},success:function(a){console.log(a),a.length>0&&window.sessionStorage.setItem("formData",JSON.stringify(JSON.stringify(a)));var b=JSON.stringify(JSON.stringify(a)),c=document.querySelector(".build-wrap"),d=document.querySelector(".render-wrap"),e=b,f=!0,g={dataType:"json"};e&&(g.formData=JSON.parse(e));var h=function(){document.body.classList.toggle("form-rendered",f),f=!f},i=$(c).formBuilder(g).data("formBuilder");h(),$(d).formRender({dataType:"json",formData:i.formData})}}),setTimeout(function(){mostrarTabla()},500)}function calcularCamposDinamicos(){for(var a="[",b=$('input[type=date]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id*="checkbox"]:not([id*="preview"]):not([id*="group"])'),c=$('div[class*="field-checkbox-group"]:not([class*="preview"])'),d=0;d<c.length;d++){a+="{";var e=c.eq(d).text().split(" ")[0].trim();a+='"label":"'+e.replace("?","")+'",',a+='"valor":""',a+="},"}for(var d=0;d<b.length;d++){a+="{";var e=b.eq(d).parent().find("label").text().trim();b.eq(d).parent().find("label").length>1&&(e=b.eq(d).parent().parent().find("label").eq(0).text().trim()),(b.eq(d).parent().find("label").length=0)&&(e=b.eq(d).parent().parent().find("label").text()),a+='"label":"'+e.replace("?","")+'",',a+='"valor":""',a+="}",d<b.length-1&&(a+=",")}a+="]";for(var f=JSON.parse(a),g=[{data:"_id",title:"<input type='checkbox' id='example-select-all'>"},{data:"indice",title:"N°"}],h="[",d=0;d<f.length;d++)h+='{"data": "'+f[d].label+'","title": "'+f[d].label+'"}',d!==f.length-1&&(h+=",");h+="]";for(var i=JSON.parse(h),d=0;d<i.length;d++)g.push(i[d]);return g.push({data:"_id",title:"Acción",render:function(a,b,c){return'<div class="btn-group"><button onClick="ver(&#39;'+a+'&#39;)" type="button" data-toggle="modal" data-target="#myModal" class="btn btn-default" >Editar</button><button type="button" onClick="eliminar(&#39;'+a+'&#39;)" id="'+a+'"class="btn btn-default" >Eliminar</button></div>'}}),g}function tomarValores(){var a="[{";a+='"campos":[';for(var b=$('div[class*="field-checkbox-group"]:not([class*="preview"])'),c=0;c<b.length;c++){var d=$(b[c]).find("label"),e=$(b[c]).find("input");a+="{";for(var f="",g="",h=1;h<d.length;h++){var i=$(d[h]).text().trim();$(e[h-1]).is(":checked")&&(f+=i+"<br>",g+=$(e[h-1]).attr("id")),""!==i&&h<d.length-1&&(g+="/*")}var j=b.eq(c).text().split(" ")[0].trim();a+='"titulo":"'+j.replace("?","")+'",',a+='"valor":"'+f+'",',a+='"id":"'+g+'"',a+="},"}for(var k=$('input[type=date]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id*="checkbox"]:not([id*="preview"]):not([id*="group"])'),c=k.length-1;c>=0;c--)if(k.eq(c).length>0){var l=k.eq(c).parent().find("label").eq(0).text().trim(),m=""===k.eq(c).val()?" ":k.eq(c).val();if(k.eq(c).attr("id").indexOf("radio-group")!==-1){l=k.eq(c).parent().parent().find("label").eq(0).text().trim();var n=k.eq(c).attr("id").split("-")[3];m=k.eq(c).parent().find("label").eq(n).text().trim()}if(k.eq(c).attr("id").indexOf("select-")!==-1&&(m=k.eq(c).find("option:selected").val()),k.eq(c).attr("id").indexOf("file-")!==-1){var o=k.eq(c).attr("id").split("-")[1],p=$("#imagen"+o+" img").prop("src");void 0!==p&&""!==p||(p="/images/default.png"),m="<img src="+p+" style=height:80px;width:80px;>"}k.eq(c).attr("id").indexOf("checkbox-")!==-1&&(l=0===k.eq(c).parent().find("label").length?k.eq(c).parent().parent().find("label").text().trim():k.eq(c).parent().find("label").text().trim(),m=$("#"+k.eq(c).attr("id")).is(":checked")),a+='{"id":"'+k.eq(c).attr("id")+'",',a+='"titulo":"'+l.replace("?","")+'",',a+='"valor":"'+m+'"}',c>0&&(a+=",")}a+="]}",a+="]";var q=JSON.parse(a)[0];return q}function mostrarTabla(){$.ajax({url:"/account/vendedor/listar/",type:"GET",error:function(a){console.log(a)},success:function(a){mostrar(a)}})}function mostrar(a){for(var b=a,c=$('input[type=date]:not([id*="preview"]),input[type=file]:not([id*="preview"]),input[id^="number-"]:not([id*="preview"]),input[id^="text-"]:not([id*="preview"]),textarea[id^="textarea-"]:not([id*="preview"]),select[id^="select-"]:not([id*="preview"]),input[id^="radio-group-"]:checked:not([id*="preview"]),input[id^="checkbox-"]:not([id*="preview"])'),d=0;d<b.length;d++)for(var e=0;e<c.length;e++){var f=c.eq(c.length-1-e).parent().find("label").eq(0).text().trim();c.eq(e).parent().find("label").length>1&&(f=c.eq(c.length-1-e).parent().parent().find("label").eq(0).text().trim()),(c.eq(d).parent().find("label").length=0)&&(f=c.eq(c.length-1-e).parent().parent().find("label").eq(0).text().trim()),f=f.replace("?",""),void 0!==b[d]&&void 0===b[d][f]&&(b[d][f]=""),void 0!==b[d]&&void 0!==b[d].campos[e]&&void 0!=b[d].campos[e].titulo&&(b[d][b[d].campos[e].titulo]=b[d].campos[e].valor)}table=$("#example").DataTable({data:b,columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],columns:calcularCamposDinamicos(),columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:function(a,b,c,d){return'<input type="checkbox" class="'+$("<div/>").text(a).html()+'">'}}],destroy:!0,dom:'T<"clear">lfrtip',tableTools:{sSwfPath:"http://"+window.location.hostname+":"+window.location.port+"/swf/copy_csv_xls_pdf.swf"}}),"0"===$("#example tbody").find("tr").eq(0).find("td").eq(1).text()&&$("#example_filter label").append("<button class='btn-danger' id='deleteAll'>Eliminar</button>"),$("#example-select-all").on("click",function(){var a=table.rows({search:"applied"}).nodes();$('input[type="checkbox"]',a).prop("checked",this.checked)}),$("#deleteAll").click(function(){confirm("Esta Seguro?")&&(toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.warning("Los vendedores se han Eliminado!.","Importante!"),$("input[type='checkbox']").each(function(){$(this).is(":checked")&&$.ajax({url:"http://"+window.location.hostname+":"+window.location.port+"/account/vendedor/",type:"DELETE",data:{id:$(this).attr("class")},error:function(a){console.log("Error "+a)},success:function(a){mostrarTabla()}})}))})}$(document).ready(function(){generarCampos(),$("#menuContactos").click(),$("#menuCientes").click(),$("#in_3").css({outline:"none","background-color":"#393a39",color:"white"}),console.log("ready!"),$("#actualizar").hide(),$(".alert").hide(),$("#guardar").show(),$("#ingresar").click(function(){$("#guardar").show(),$("#actualizar").hide(),$("input,textarea").val(""),$(".alert").hide()}),$("#guardar").click(function(){$.ajax({url:"/account/vendedor/",type:"POST",data:{data:tomarValores(),usuario:$("#usuario").attr("class"),modulo:$("#modulo").attr("class")},error:function(a){console.log(a)},success:function(a){""!=a&&(toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.success("Se ha Guardado el Producto.","Felicidades!"),mostrarTabla(),$("#myModal").modal("hide"),$("#myModal").hide(),$(".modal-backdrop").hide())}})}),$("#actualizar").click(function(){$(".alert").hide(),toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-top-center",preventDuplicates:!1,timeOut:"1000",onclick:function(){console.log("Toco el Mensaje")}},toastr.info("Actualizado Correctamente.","Felicidades!"),$.ajax({url:"/account/vendedor/",type:"PUT",data:{_id:$("#id").val(),data:tomarValores()},error:function(a){console.log(a)},success:function(a){""!=a&&($(".alert").show(),mostrarTabla())}})})});
//# sourceMappingURL=index.min.js.map